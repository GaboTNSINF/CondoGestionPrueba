<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Cierre Mensual - {{ condominio.nombre }}</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; max-width: 600px; margin: 20px auto; }
        .stat { font-size: 1.2em; margin: 10px 0; }
        .amount { font-weight: bold; color: #333; }
        .btn { padding: 10px 20px; border: none; cursor: pointer; border-radius: 4px; text-decoration: none; display: inline-block; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-secondary { background-color: #6c757d; color: white; }
        .alert { padding: 10px; background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 4px; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div style="text-align: center;">
        <h1>Cierre Mensual</h1>
        <h2>{{ condominio.nombre }}</h2>
        <p>Periodo: <strong>{{ periodo }}</strong></p>
    </div>

    {% if messages %}
        <div style="max-width: 600px; margin: 0 auto;">
        {% for message in messages %}
            <div class="alert">{{ message }}</div>
        {% endfor %}
        </div>
    {% endif %}

    <div class="card">
        <h3>Resumen del Periodo</h3>
        <p class="stat">Total Gastos Registrados: <span class="amount">$ {{ total_gastos|floatformat:0 }}</span></p>

        <hr>

        {% if ya_cerrado %}
            <div style="background-color: #e2e3e5; padding: 10px; border-radius: 4px; text-align: center;">
                <p><strong>¡Este mes ya fue cerrado!</strong></p>
                <p>Se generaron {{ cantidad_cobros }} boletas por un total de: <strong>$ {{ total_cobrado|floatformat:0 }}</strong></p>
                <div style="margin-top: 15px;">
                    <a href="{% url 'cobros_list' condominio.id_condominio periodo %}" class="btn btn-primary">Ver Boletas Generadas</a>
                </div>
                <div style="margin-top: 10px;">
                     <form method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-secondary" onclick="return confirm('¿Seguro que deseas re-generar el cierre? Esto actualizará los montos.')">Re-generar Cierre</button>
                    </form>
                </div>
            </div>
        {% else %}
            <p>Aún no se han generado cobros para este periodo.</p>
            <div style="text-align: center; margin-top: 20px;">
                <form method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success">Generar Cierre y Cobros</button>
                </form>
            </div>
        {% endif %}
    </div>

    <div style="text-align: center; margin-top: 20px;">
        <a href="{% url 'index' %}" class="btn btn-secondary">Volver al Dashboard</a>
    </div>

</body>
</html>
